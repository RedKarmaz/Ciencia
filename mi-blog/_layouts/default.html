<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- El título cambia según la página -->
    <title>{{ page.title }}</title>
    <script src="[https://cdn.tailwindcss.com](https://cdn.tailwindcss.com)"></script>
    <link href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css)" rel="stylesheet">
    <link href="[https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300&family=Inter:wght@400;600;800&display=swap](https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300&family=Inter:wght@400;600;800&display=swap)" rel="stylesheet">
    
    <style>
        body { font-family: 'Merriweather', serif; color: #1a202c; background-color: #fcfbf9; }
        h1, h2, h3, .ui-font { font-family: 'Inter', sans-serif; }
        
        /* Estilos Glosario */
        .term { transition: all 0.3s ease; cursor: text; }
        body.mode-glossary .term { background-color: #fef08a; border-bottom: 2px dashed #ca8a04; cursor: help; padding: 0 2px; border-radius: 4px; }
        
        /* Estilos Fuentes */
        .source-marker { display: none; font-family: 'Inter', sans-serif; font-size: 0.75rem; vertical-align: super; color: #2563eb; font-weight: bold; cursor: pointer; margin-left: 2px; }
        body.mode-sources .source-marker { display: inline-block; animation: popIn 0.3s; }
        body.mode-sources .source-highlight { background-color: #dbeafe; border-radius: 4px; }
        
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Tooltips */
        .tooltip-card { position: absolute; z-index: 50; background: white; border-radius: 8px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #e5e7eb; max-width: 300px; display: none; font-family: 'Inter', sans-serif; }
        .tooltip-card.active { display: block; }
        .tooltip-arrow { position: absolute; width: 12px; height: 12px; background: white; transform: rotate(45deg); border-left: 1px solid #e5e7eb; border-top: 1px solid #e5e7eb; }
        .tooltip-glossary { border-left: 4px solid #ca8a04; }
        .tooltip-source { border-left: 4px solid #2563eb; }
    </style>
</head>
<body class="antialiased">

    <!-- Panel de Control Flotante -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-40 bg-white/90 backdrop-blur-md shadow-2xl rounded-full px-6 py-3 border border-gray-200 flex gap-4 items-center w-max max-w-[95%] overflow-x-auto ui-font">
        <button id="btn-glossary" onclick="toggleMode('glossary')" class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-yellow-50 text-gray-600 border border-gray-200">
            <i class="fa-solid fa-book-open"></i> <span>Conceptos Difíciles</span>
        </button>
        <button id="btn-sources" onclick="toggleMode('sources')" class="flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-blue-50 text-gray-600 border border-gray-200">
            <i class="fa-solid fa-magnifying-glass-chart"></i> <span>Fuentes</span>
        </button>
    </div>

    <nav class="bg-white border-b border-gray-100 py-6">
        <div class="max-w-3xl mx-auto px-4 font-black text-2xl tracking-tighter text-gray-900">
            <a href="{{ '/' | relative_url }}" class="hover:text-indigo-600 transition-colors">
                Cien<span class="text-indigo-600">cia</span>Abierta.
            </a>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-4 py-12 mb-20">
        <!-- AQUÍ SE INSERTARÁ TU ARTÍCULO AUTOMÁTICAMENTE -->
        {{ content }}
    </main>

    <!-- Tooltip Element -->
    <div id="tooltip" class="tooltip-card">
        <div class="tooltip-arrow"></div>
        <div class="p-4">
            <div id="tooltip-title" class="text-xs font-bold uppercase tracking-wider mb-1 text-gray-500"></div>
            <p id="tooltip-content" class="text-sm text-gray-800 leading-snug"></p>
        </div>
    </div>

    <script>
        const state = { glossary: false, sources: false };
        const tooltip = document.getElementById('tooltip');
        const tooltipContent = document.getElementById('tooltip-content');
        const tooltipTitle = document.getElementById('tooltip-title');
        
        // Las fuentes vendrán definidas dentro de cada post en window.postSources
        const sourcesData = window.postSources || {};

        function init() {
            // Lógica para glosario
            document.querySelectorAll('.term').forEach(term => {
                term.addEventListener('click', (e) => state.glossary && showTooltip(e, term.dataset.def, 'glossary'));
            });

            // Lógica para fuentes
            document.querySelectorAll('.source-wrapper').forEach(el => {
                const id = el.dataset.sourceId;
                const marker = document.createElement('span');
                marker.className = 'source-marker';
                marker.innerHTML = `<i class="fa-solid fa-circle-info"></i>`;
                marker.addEventListener('click', (e) => showTooltip(e, sourcesData[id], 'source', id));
                el.appendChild(marker);
                
                marker.addEventListener('mouseenter', () => el.classList.add('source-highlight'));
                marker.addEventListener('mouseleave', () => el.classList.remove('source-highlight'));
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.term') && !e.target.closest('.source-marker') && !e.target.closest('#tooltip')) hideTooltip();
            });
        }

        function toggleMode(mode) {
            state[mode] = !state[mode];
            document.body.classList.toggle(`mode-${mode}`);
            const btn = document.getElementById(mode === 'glossary' ? 'btn-glossary' : 'btn-sources');
            if (state[mode]) {
                btn.classList.add(mode === 'glossary' ? 'bg-yellow-100' : 'bg-blue-100', mode === 'glossary' ? 'text-yellow-800' : 'text-blue-800', mode === 'glossary' ? 'border-yellow-400' : 'border-blue-400');
            } else {
                btn.className = "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold transition-all hover:bg-gray-50 text-gray-600 border border-gray-200";
            }
            if(!state[mode]) hideTooltip();
        }

        function showTooltip(e, content, type, id) {
            e.stopPropagation();
            tooltip.className = `tooltip-card active tooltip-${type}`;
            tooltipTitle.textContent = type === 'glossary' ? "Definición" : "Fuente Original";
            tooltipTitle.className = `text-xs font-bold uppercase tracking-wider mb-1 ${type === 'glossary' ? 'text-yellow-600' : 'text-blue-600'}`;
            
            if (type === 'source') {
                tooltipContent.innerHTML = `${content} <br><a href="#ref-${id}" class="text-blue-500 hover:underline mt-2 inline-block text-xs">Ver bibliografía ↓</a>`;
            } else {
                tooltipContent.textContent = content;
            }

            const rect = e.target.getBoundingClientRect();
            const top = rect.top + window.pageYOffset - tooltip.offsetHeight - 10;
            const left = Math.max(10, Math.min(window.innerWidth - tooltip.offsetWidth - 10, rect.left + (rect.width / 2) - (tooltip.offsetWidth / 2)));
            
            tooltip.style.top = `${top}px`;
            tooltip.style.left = `${left}px`;
            
            const arrow = tooltip.querySelector('.tooltip-arrow');
            arrow.style.left = `${(rect.left + rect.width/2) - left - 6}px`;
            arrow.style.bottom = "-6px";
        }

        function hideTooltip() { tooltip.classList.remove('active'); }
        
        // Esperar a que cargue todo
        window.addEventListener('load', init);
    </script>
</body>
</html>